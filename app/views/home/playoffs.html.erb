<% if notice.present? %>
  <p style="color: green"><%= notice %></p>
<% end %>
<div class="d-flex flex-column">
  <% if @playoffs.nil? %>
    <div class="d-flex flex-column align-self-center">
      <h2 class="m-0">No Playoff Matches Scheduled Yet</h2>
    </div>
  <% else %>
    <div id="playoffCarousel" class="carousel slide pb-3 blur-background">
      <div class="carousel-indicators">
        <% [@semifinals, @finals].each_with_index do |round, index| %>
          <button type="button"
            data-bs-target="#playoffCarousel"
            data-bs-slide-to="<%= index %>"
            class="<%= 'active' if index.zero? %>"
            aria-current="<%= 'true' if index.zero? %>"
            aria-label="Slide <%= index + 1 %>">
          </button>
        <% end %>
      </div>
      <div class="carousel-inner h-100">
        <!-- Slide 1: Semifinals -->
        <div class="carousel-item active">
          <div class="card glass-card semifinals-card">
            <div class="card-header text-center hero-background p-2">
              <h3 class="m-0">Semifinals</h3>
            </div>
            <div class="card-body d-flex align-items-stretch">
              <div class="d-flex flex-column w-100 justify-content-between flex-grow-1 m-3">
                <% @semifinals.each_with_index do |match, i| %>
                  <div class="d-flex flex-column gap-1 ">
                    <!-- Player 1 -->
                    <div class="border half-rounded-right d-flex flex-row w-75 text-white header-gradient <%= 'winner' if match.winner_id == match.player_1_id %>">
                      <div class="p-2 half-rounded-right hero-background"><%= match.player_1_seed %></div>
                      <div class="d-flex align-items-center ps-2 "><%= User.find(match.player_1_id).email.split('@').first %></div>
                    </div>
                    <!-- Player 2 -->
                    <div class="border half-rounded-right d-flex flex-row w-75 text-white header-gradient <%= 'winner' if match.winner_id == match.player_2_id %>">
                      <div class="p-2 half-rounded-right hero-background"><%= match.player_2_seed %></div>
                      <div class="d-flex align-items-center ps-2"><%= User.find(match.player_2_id).email.split('@').first %></div>
                    </div>
                    <!-- Admin form -->
                    <% unless match.winner_id %>
                      <% if admin? %>
                        <div class="mt-3">
                          <%= form_with url: playoff_result_path(match), method: :patch do |f| %>
                            <%= f.hidden_field :playoff_id, value: match.id %>
                            <div class="d-flex flex-column gap-2">
                              <label><%= f.radio_button :winner_id, match.player_1_id %> <%= User.find(match.player_1_id).email.split('@').first %></label>
                              <label><%= f.radio_button :winner_id, match.player_2_id %> <%= User.find(match.player_2_id).email.split('@').first %></label>
                              <%= f.submit "Submit Winner", class: "btn btn-primary mt-2" %>
                            </div>
                          <% end %>
                        </div>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        <!-- Slide 2: Finals -->
        <div class="finals-background">
          <div class="carousel-item">
            <div class="card finals-card glass-card h-50">
              <div class="card-header text-center hero-background p-2">
                <h1 class="m-0">Finals</h1>
              </div>
              <div class="card-body d-flex flex-column justify-content-center ps-5">
                <!-- Finals not ready / no winners yet -->
                <% if @finals.blank? || @finals.all? { |m| m.winner_id.nil? } %>
                  <div class="d-flex flex-column gap-4">
                    <!-- Player 1 -->
                    <div class="border half-rounded-right d-flex flex-row w-75 text-white header-gradient ">
                      <div class="p-2 hero-background half-rounded-right ">?</div>
                      <div class="d-flex align-items-center ps-2 ">Semifinal 1 Winner</div>
                    </div>
                    <!-- Player 2 -->
                    <div class="border half-rounded-right d-flex flex-row w-75 text-white header-gradient">
                      <div class="p-2 half-rounded-right hero-background">?</div>
                      <div class="d-flex align-items-center ps-2">Semifinal 2 Winner</div>
                    </div>
                  </div>
                <% else %>
                  <% @finals.each do |match| %>
                    <div class="match d-flex flex-column align-items-center">
                      <!-- Player 1 -->
                      <div class="team <%= 'winner' if match.winner_id == match.player_1_id %>">
                        <span class="seed">#<%= match.player_1_seed %></span>
                        <span class="name"><%= User.find(match.player_1_id).email.split('@').first %></span>
                      </div>
                      <div class="vs my-2"><%= image_tag 'vs.png', width: 50, height: 50 %></div>
                      <!-- Player 2 -->
                      <div class="team <%= 'winner' if match.winner_id == match.player_2_id %>">
                        <span class="seed">#<%= match.player_2_seed %></span>
                        <span class="name"><%= User.find(match.player_2_id).email.split('@').first %></span>
                      </div>
                      <!-- Admin form -->
                      <% unless match.winner_id %>
                        <% if admin? %>
                          <div class="mt-3">
                            <%= form_with url: playoff_result_path(match), method: :patch do |f| %>
                              <%= f.hidden_field :playoff_id, value: match.id %>
                              <div class="d-flex flex-column gap-2">
                                <label><%= f.radio_button :winner_id, match.player_1_id %> <%= User.find(match.player_1_id).email.split('@').first %></label>
                                <label><%= f.radio_button :winner_id, match.player_2_id %> <%= User.find(match.player_2_id).email.split('@').first %></label>
                                <%= f.submit "Submit Winner", class: "btn btn-primary mt-2" %>
                              </div>
                            <% end %>
                          </div>
                        <% end %>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <button class="carousel-control-prev" type="button" data-bs-target="#playoffCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class=" "></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#playoffCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class=" "></span>
        </button>
      </div>
    <% end %>
  </div>